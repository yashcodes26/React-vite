const imageInput = document.getElementById("imageInput");
const previewImage = document.getElementById("previewImage");
const generateBtn = document.getElementById("generateBtn");
const downloadBtn = document.getElementById("downloadBtn");
const captionText = document.getElementById("captionText");
const loading = document.getElementById("loading");

// Preview uploaded image
imageInput.addEventListener("change", () => {
  const file = imageInput.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = () => {
      previewImage.src = reader.result;
      previewImage.style.display = "block";
    };
    reader.readAsDataURL(file);
  }
});

// Generate caption
generateBtn.addEventListener("click", async () => {
  if (!imageInput.files[0]) {
    captionText.textContent = "âš ï¸ Please upload an image first.";
    downloadBtn.style.display = "none";
    return;
  }

  captionText.textContent = "";
  loading.style.display = "block";
  downloadBtn.style.display = "none";

  // Simulating AI caption generation
  await new Promise((resolve) => setTimeout(resolve, 2000));

  const captions = [
    "A masterpiece in pixels ðŸŽ¨",
    "When your camera accidentally takes a good photo ðŸ“¸",
    "Looks like a future meme template ðŸ˜Ž",
    "I see beauty, I see chaos, I see... art.",
    "AI says: wow, that lighting tho ðŸ’¡"
  ];
  const randomCaption = captions[Math.floor(Math.random() * captions.length)];

  loading.style.display = "none";
  captionText.textContent = randomCaption;

  // Show download button
  downloadBtn.style.display = "inline-block";
});

// Download image with caption
downloadBtn.addEventListener("click", () => {
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");
  const img = previewImage;

  canvas.width = img.naturalWidth;
  canvas.height = img.naturalHeight + 50; // extra space for caption

  // Draw image
  ctx.drawImage(img, 0, 0);

  // Draw caption
  ctx.fillStyle = "white";
  ctx.font = "bold 30px Poppins, sans-serif";
  ctx.textAlign = "center";
  ctx.fillText(captionText.textContent, canvas.width / 2, canvas.height - 20);

  // Download
  const link = document.createElement("a");
  link.download = "captioned-image.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
});
